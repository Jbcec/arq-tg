const projectsData = {
    social: [
        {
            name: 'JUANA LA LOCA',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/777/fff?text=JUANA+LA+LOCA+1',
                'https://via.placeholder.com/800x600/777/fff?text=JUANA+LA+LOCA+2',
                'https://via.placeholder.com/800x600/777/fff?text=JUANA+LA+LOCA+3',
                'https://via.placeholder.com/800x600/777/fff?text=JUANA+LA+LOCA+4'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.'
        },
        {
            name: 'JUANA LA LOCA 2',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/777/fff?text=JUANA+2-1',
                'https://via.placeholder.com/800x600/777/fff?text=JUANA+2-2',
                'https://via.placeholder.com/800x600/777/fff?text=JUANA+2-3'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore.'
        },
        {
            name: 'LA VICCA',
            location: 'Majadahonda',
            images: [
                'https://via.placeholder.com/800x600/777/fff?text=LA+VICCA+1',
                'https://via.placeholder.com/800x600/777/fff?text=LA+VICCA+2',
                'https://via.placeholder.com/800x600/777/fff?text=LA+VICCA+3',
                'https://via.placeholder.com/800x600/777/fff?text=LA+VICCA+4'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.'
        },
        {
            name: 'PARADA CERO',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/777/fff?text=PARADA+CERO+1',
                'https://via.placeholder.com/800x600/777/fff?text=PARADA+CERO+2',
                'https://via.placeholder.com/800x600/777/fff?text=PARADA+CERO+3'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.'
        },
        {
            name: 'PIZZA TRAIN',
            location: 'Barcelona',
            images: [
                'https://via.placeholder.com/800x600/777/fff?text=PIZZA+TRAIN+1',
                'https://via.placeholder.com/800x600/777/fff?text=PIZZA+TRAIN+2',
                'https://via.placeholder.com/800x600/777/fff?text=PIZZA+TRAIN+3',
                'https://via.placeholder.com/800x600/777/fff?text=PIZZA+TRAIN+4'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.'
        }
    ],
    residential: [
        {
            name: 'ALVEAR',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=ALVEAR+1',
                'https://via.placeholder.com/800x600/666/fff?text=ALVEAR+2',
                'https://via.placeholder.com/800x600/666/fff?text=ALVEAR+3'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.'
        },
        {
            name: 'ARTURO SORIA',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=ARTURO+SORIA+1',
                'https://via.placeholder.com/800x600/666/fff?text=ARTURO+SORIA+2',
                'https://via.placeholder.com/800x600/666/fff?text=ARTURO+SORIA+3',
                'https://via.placeholder.com/800x600/666/fff?text=ARTURO+SORIA+4'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore.'
        },
        {
            name: 'C13',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=C13+1',
                'https://via.placeholder.com/800x600/666/fff?text=C13+2',
                'https://via.placeholder.com/800x600/666/fff?text=C13+3'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.'
        },
        {
            name: 'LT',
            location: 'Barcelona',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=LT+1',
                'https://via.placeholder.com/800x600/666/fff?text=LT+2',
                'https://via.placeholder.com/800x600/666/fff?text=LT+3'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut enim ad minim veniam, quis nostrud exercitation.'
        },
        {
            name: 'RB26',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=RB26+1',
                'https://via.placeholder.com/800x600/666/fff?text=RB26+2',
                'https://via.placeholder.com/800x600/666/fff?text=RB26+3',
                'https://via.placeholder.com/800x600/666/fff?text=RB26+4'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore.'
        },
        {
            name: 'RGS',
            location: 'Valencia',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=RGS+1',
                'https://via.placeholder.com/800x600/666/fff?text=RGS+2',
                'https://via.placeholder.com/800x600/666/fff?text=RGS+3'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis aute irure dolor in reprehenderit.'
        },
        {
            name: 'SANCHINARRO',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=SANCHINARRO+1',
                'https://via.placeholder.com/800x600/666/fff?text=SANCHINARRO+2',
                'https://via.placeholder.com/800x600/666/fff?text=SANCHINARRO+3',
                'https://via.placeholder.com/800x600/666/fff?text=SANCHINARRO+4'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.'
        }
    ],
    flipping: [
        {
            name: 'PROYECTO FLIPPING 1',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+1-1',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+1-2',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+1-3'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.'
        },
        {
            name: 'PROYECTO FLIPPING 2',
            location: 'Barcelona',
            images: [
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+2-1',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+2-2',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+2-3',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+2-4'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore.'
        },
        {
            name: 'PROYECTO FLIPPING 3',
            location: 'Valencia',
            images: [
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+3-1',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+3-2',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+3-3'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.'
        }
    ]
};

let currentProjectSection = null;
let currentProjectIndex = 0;
let currentImageIndex = 0;
let modalInactivityTimer = null;
let lastScrollY = window.scrollY;

// ==================== WELCOME ANIMATION ====================
window.addEventListener('DOMContentLoaded', () => {
    const welcome = document.getElementById('welcome-screen');
    const logoAnim = document.getElementById('logo-anim');
    const sloganAnim = document.getElementById('slogan-anim');

    setTimeout(() => {
        logoAnim.classList.add('shifted');
        sloganAnim.classList.add('visible');
    }, 1000);

    setTimeout(() => {
        welcome.style.opacity = 0;
        setTimeout(() => {
            welcome.style.display = 'none';
        }, 1000);
    }, 3200);
    
    renderProjects('social');
    renderProjects('residential');
    renderProjects('flipping');
});

// ==================== MOBILE NAVIGATION ====================
const navToggle = document.getElementById('nav-toggle');
const navList = document.getElementById('nav-list');

navToggle.addEventListener('click', () => {
    navList.classList.toggle('show');
});

document.addEventListener('click', (e) => {
    if (window.innerWidth <= 700) {
        const nav = document.querySelector('nav');
        if (!nav.contains(e.target)) {
            navList.classList.remove('show');
        }
    }
});

// ==================== SECTION NAVIGATION ====================
const navLinks = document.querySelectorAll('nav a[data-section]');
const sections = document.querySelectorAll('.main-section');

navLinks.forEach(link => {
    link.addEventListener('click', (e) => {
        e.preventDefault();
        const section = link.dataset.section;
        
        navLinks.forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        
        sections.forEach(s => s.classList.remove('active'));
        document.getElementById(`section-${section}`).classList.add('active');
        
        navList.classList.remove('show');
    });
});

// ==================== HEADER SCROLL BEHAVIOR ====================
const header = document.querySelector('header');

window.addEventListener('scroll', () => {
    const currentScrollY = window.scrollY;
    
    if (currentScrollY > lastScrollY && currentScrollY > 100) {
        header.classList.add('hidden');
    } else {
        header.classList.remove('hidden');
    }
    
    lastScrollY = currentScrollY;
});

// ==================== PROJECT MODAL ====================
const modal = document.getElementById('project-modal');
const modalClose = document.getElementById('modal-close');
const modalInfo = document.getElementById('modal-info');
const modalTitle = document.getElementById('modal-title');
const modalText = document.getElementById('modal-text');
const modalImage = document.getElementById('modal-image');
const modalCounter = document.getElementById('modal-counter');
const modalPrev = document.getElementById('modal-prev');
const modalNext = document.getElementById('modal-next');
const nextProjectInfo = document.getElementById('next-project-info');
const nextProjectData = document.getElementById('next-project-data');

function openProjectModal(section, projectIndex) {
    currentProjectSection = section;
    currentProjectIndex = projectIndex;
    currentImageIndex = 0;
    
    updateModalContent();
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
    resetModalInactivity();
}

function closeProjectModal() {
    modal.classList.remove('active');
    document.body.style.overflow = '';
    clearTimeout(modalInactivityTimer);
}

function updateModalContent() {
    const project = projectsData[currentProjectSection][currentProjectIndex];
    const totalImages = project.images.length;
    const isLastImage = currentImageIndex === totalImages - 1;
    const hasNextProject = currentProjectIndex < projectsData[currentProjectSection].length - 1;
    const isFirstImage = currentImageIndex === 0;
    
    modalTitle.textContent = project.name;
    modalText.textContent = project.description;
    modalImage.src = project.images[currentImageIndex];
    modalImage.alt = `${project.name} - Imagen ${currentImageIndex + 1}`;
    modalCounter.textContent = `${String(currentImageIndex + 1).padStart(2, '0')} — ${String(totalImages).padStart(2, '0')}`;
    
    if (isFirstImage) {
        modalInfo.classList.remove('hide-description');
    } else {
        modalInfo.classList.add('hide-description');
    }
    
    if (isLastImage && hasNextProject) {
        const nextProject = projectsData[currentProjectSection][currentProjectIndex + 1];
        nextProjectData.innerHTML = `
            <div class="next-project-data-item">
                <span class="next-project-data-label">${nextProject.name}</span>
                <span class="next-project-data-value"></span>
            </div>
            <div class="next-project-data-item">
                <span class="next-project-data-label">Categoría</span>
                <span class="next-project-data-value">Arquitectura Residencial</span>
            </div>
            <div class="next-project-data-item">
                <span class="next-project-data-label">Área</span>
                <span class="next-project-data-value">450 m²</span>
            </div>
            <div class="next-project-data-item">
                <span class="next-project-data-label">Año</span>
                <span class="next-project-data-value">2025</span>
            </div>
            <div class="next-project-data-item">
                <span class="next-project-data-label">Diseño</span>
                <span class="next-project-data-value">Estudio Berd</span>
            </div>
            <div class="next-project-data-item">
                <span class="next-project-data-label">Contratista General</span>
                <span class="next-project-data-value">Estudio IN SITU/</span>
            </div>
            <div class="next-project-data-item">
                <span class="next-project-data-label">Ciudad</span>
                <span class="next-project-data-value">Madrid</span>
            </div>
            <div class="next-project-data-item">
                <span class="next-project-data-label">País</span>
                <span class="next-project-data-value">España</span>
            </div>
        `;
        nextProjectInfo.dataset.canShow = 'true';
    } else {
        nextProjectInfo.dataset.canShow = 'false';
        nextProjectInfo.classList.remove('visible');
    }
    
    resetModalInactivity();
}

function navigateModalImage(direction) {
    const project = projectsData[currentProjectSection][currentProjectIndex];
    const totalImages = project.images.length;
    const isLastImage = currentImageIndex === totalImages - 1;
    const hasNextProject = currentProjectIndex < projectsData[currentProjectSection].length - 1;
    const hasPrevProject = currentProjectIndex > 0;
    
    if (direction === 'next') {
        if (isLastImage && hasNextProject) {
            currentProjectIndex++;
            currentImageIndex = 0;
        } else if (!isLastImage) {
            currentImageIndex++;
        }
    } else {
        if (currentImageIndex > 0) {
            currentImageIndex--;
        } else if (hasPrevProject) {
            currentProjectIndex--;
            currentImageIndex = projectsData[currentProjectSection][currentProjectIndex].images.length - 1;
        }
    }
    
    updateModalContent();
}

modalClose.addEventListener('click', (e) => {
    e.stopPropagation();
    closeProjectModal();
});

modalPrev.addEventListener('click', (e) => {
    e.stopPropagation();
    navigateModalImage('prev');
});

modalNext.addEventListener('click', (e) => {
    e.stopPropagation();
    navigateModalImage('next');
});

// Show next project info on hover - FIX PRINCIPAL
modalNext.addEventListener('mouseenter', () => {
    if (nextProjectInfo.dataset.canShow === 'true') {
        nextProjectInfo.classList.add('visible');
    }
});

modalNext.addEventListener('mouseleave', () => {
    nextProjectInfo.classList.remove('visible');
});

modal.addEventListener('click', (e) => {
    if (e.target === modal) {
        closeProjectModal();
    }
});

modal.addEventListener('mousemove', () => {
    if (modal.classList.contains('active')) {
        resetModalInactivity();
    }
});

// ==================== MODAL UI AUTO-HIDE ====================
const modalUIElements = [modalPrev, modalNext, modalCounter];

function hideModalUI() {
    modalUIElements.forEach(el => el.classList.add('hide-ui'));
}

function showModalUI() {
    modalUIElements.forEach(el => el.classList.remove('hide-ui'));
}

function resetModalInactivity() {
    showModalUI();
    clearTimeout(modalInactivityTimer);
    modalInactivityTimer = setTimeout(hideModalUI, 3000);
}

// Keyboard navigation
document.addEventListener('keydown', (e) => {
    if (modal.classList.contains('active')) {
        if (e.key === 'Escape') {
            closeProjectModal();
        } else if (e.key === 'ArrowLeft') {
            navigateModalImage('prev');
        } else if (e.key === 'ArrowRight') {
            navigateModalImage('next');
        }
        resetModalInactivity();
    }
});

// ==================== TOUCH SWIPE FOR MOBILE ====================
let touchStartX = 0;
let touchEndX = 0;

function handleSwipe() {
    if (touchEndX < touchStartX - 50) {
        navigateModalImage('next');
    }
    if (touchEndX > touchStartX + 50) {
        navigateModalImage('prev');
    }
}

modal.addEventListener('touchstart', (e) => {
    if (modal.classList.contains('active')) {
        touchStartX = e.changedTouches[0].screenX;
    }
}, false);

modal.addEventListener('touchend', (e) => {
    if (modal.classList.contains('active')) {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
    }
}, false);

// ==================== RENDER PROJECTS GRID ====================
function renderProjects(section) {
    const container = document.getElementById(`${section}-projects`);
    if (!container || !projectsData[section]) {
        return;
    }
    
    container.innerHTML = '';
    
    projectsData[section].forEach((project, index) => {
        const card = document.createElement('div');
        card.className = 'project-card';
        card.innerHTML = `
            <img src="${project.images[0]}" alt="${project.name}" class="project-image">
            <div class="project-info">
                <div class="project-name">${project.name}</div>
                <div class="project-location">${project.location}</div>
            </div>
        `;
        card.addEventListener('click', () => {
            openProjectModal(section, index);
        });
        container.appendChild(card);
    });
}
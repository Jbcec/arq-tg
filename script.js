const projectsData = {
    social: [
        {
            name: 'ANCHO',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/777/fff?text=ANCHO+1',
                'https://via.placeholder.com/800x600/777/fff?text=ANCHO+2',
                'https://via.placeholder.com/800x600/777/fff?text=ANCHO+3'
            ],
            category: 'Arquitectura Gastronómica',
            area: '130 m²',
            year: '2025',
            design: 'Estudio Bend',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Garcia Paredes 27',
            tag: 'Próximamente'
        },
        {
            name: 'FENZZE',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/777/fff?text=FENZZE+1',
                'https://via.placeholder.com/800x600/777/fff?text=FENZZE+2',
                'https://via.placeholder.com/800x600/777/fff?text=FENZZE+3'
            ],
            category: 'Arquitectura Gastronómica',
            area: '130 m²',
            year: '2025',
            design: 'Estudio Bend',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Castello 1',
            tag: 'Próximamente'
        },
        {
            name: 'BRAZZA',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/777/fff?text=BRAZZA+1',
                'https://via.placeholder.com/800x600/777/fff?text=BRAZZA+2',
                'https://via.placeholder.com/800x600/777/fff?text=BRAZZA+3'
            ],
            category: 'Arquitectura Gastronómica',
            area: '130 m²',
            year: '2025',
            design: 'Estudio Bend',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Garcia Paredes 27',
            tag: 'Próximamente'
        },
        {
            name: 'JUANA LA LOCA',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/777/fff?text=JUANA+LA+LOCA+1',
                'https://via.placeholder.com/800x600/777/fff?text=JUANA+LA+LOCA+2',
                'https://via.placeholder.com/800x600/777/fff?text=JUANA+LA+LOCA+3',
                'https://via.placeholder.com/800x600/777/fff?text=JUANA+LA+LOCA+4'
            ],
            category: 'Arquitectura Gastronómica',
            area: '130 m²',
            year: '2025',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Recoletos 10'
        },
        {
            name: 'PIZZA TRAIN',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/777/fff?text=PIZZA+TRAIN+1',
                'https://via.placeholder.com/800x600/777/fff?text=PIZZA+TRAIN+2',
                'https://via.placeholder.com/800x600/777/fff?text=PIZZA+TRAIN+3',
                'https://via.placeholder.com/800x600/777/fff?text=PIZZA+TRAIN+4'
            ],
            category: 'Arquitectura Gastronómica',
            area: '130 m²',
            year: '2025',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Calle del Leon 3'
        },
        {
            name: 'LA VICCA',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/777/fff?text=LA+VICCA+1',
                'https://via.placeholder.com/800x600/777/fff?text=LA+VICCA+2',
                'https://via.placeholder.com/800x600/777/fff?text=LA+VICCA+3',
                'https://via.placeholder.com/800x600/777/fff?text=LA+VICCA+4'
            ],
            category: 'Arquitectura Gastronómica',
            area: '130 m²',
            year: '2024',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Pablo Picasso 3'
        },
        {
            name: 'PARADA CERO',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/777/fff?text=PARADA+CERO+1',
                'https://via.placeholder.com/800x600/777/fff?text=PARADA+CERO+2',
                'https://via.placeholder.com/800x600/777/fff?text=PARADA+CERO+3'
            ],
            category: 'Arquitectura Gastronómica',
            area: '130 m²',
            year: '2024',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Pablo Picasso 4'
        }
    ],
    residential: [
        {
            name: 'C13',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=C13+1',
                'https://via.placeholder.com/800x600/666/fff?text=C13+2',
                'https://via.placeholder.com/800x600/666/fff?text=C13+3'
            ],
            category: 'Arquitectura Residencial',
            area: '43 m²',
            year: '2025',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Castello 13',
            tag: 'Próximamente'
        },
        {
            name: 'LT',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=LT+1',
                'https://via.placeholder.com/800x600/666/fff?text=LT+2',
                'https://via.placeholder.com/800x600/666/fff?text=LT+3'
            ],
            category: 'Arquitectura Residencial',
            area: '85 m²',
            year: '2025',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'San Juan de Ortega 10',
            tag: 'Próximamente'
        },
        {
            name: 'RB26',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=RB26+1',
                'https://via.placeholder.com/800x600/666/fff?text=RB26+2',
                'https://via.placeholder.com/800x600/666/fff?text=RB26+3',
                'https://via.placeholder.com/800x600/666/fff?text=RB26+4'
            ],
            category: 'Arquitectura Residencial',
            area: '36 m²',
            year: '2025',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Rufino Blanco 26'
        },
        {
            name: 'ALVEAR',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=ALVEAR+1',
                'https://via.placeholder.com/800x600/666/fff?text=ALVEAR+2',
                'https://via.placeholder.com/800x600/666/fff?text=ALVEAR+3'
            ],
            category: 'Arquitectura Residencial',
            area: '240 m²',
            year: '2025',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Av Alvear 1491'
        },
        {
            name: 'ARTURO SORIA I',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=ARTURO+SORIA+I+1',
                'https://via.placeholder.com/800x600/666/fff?text=ARTURO+SORIA+I+2',
                'https://via.placeholder.com/800x600/666/fff?text=ARTURO+SORIA+I+3'
            ],
            category: 'Arquitectura Residencial',
            area: '200 m²',
            year: '2023',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Lorenzo Solano Tendero 19'
        },
        {
            name: 'ARTURO SORIA II',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=ARTURO+SORIA+II+1',
                'https://via.placeholder.com/800x600/666/fff?text=ARTURO+SORIA+II+2',
                'https://via.placeholder.com/800x600/666/fff?text=ARTURO+SORIA+II+3',
                'https://via.placeholder.com/800x600/666/fff?text=ARTURO+SORIA+II+4'
            ],
            category: 'Arquitectura Residencial',
            area: '110 m²',
            year: '2023',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Gran Vía de Hortaleza 5'
        },
        {
            name: 'RGS',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=RGS+1',
                'https://via.placeholder.com/800x600/666/fff?text=RGS+2',
                'https://via.placeholder.com/800x600/666/fff?text=RGS+3'
            ],
            category: 'Arquitectura Residencial',
            area: '76 m²',
            year: '2024',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Ramon Gomez de la Serna 25'
        },
        {
            name: 'SANCHINARRO',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=SANCHINARRO+1',
                'https://via.placeholder.com/800x600/666/fff?text=SANCHINARRO+2',
                'https://via.placeholder.com/800x600/666/fff?text=SANCHINARRO+3',
                'https://via.placeholder.com/800x600/666/fff?text=SANCHINARRO+4'
            ],
            category: 'Arquitectura Residencial',
            area: '160 m²',
            year: '2024',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Madrid',
            country: 'España',
            street: 'Ana de Austria 44'
        },
        {
            name: 'GUIDO',
            location: 'Buenos Aires',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=GUIDO+1',
                'https://via.placeholder.com/800x600/666/fff?text=GUIDO+2',
                'https://via.placeholder.com/800x600/666/fff?text=GUIDO+3'
            ],
            category: 'Arquitectura Residencial',
            area: '160 m²',
            year: '2023',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Ciudad de Buenos Aires',
            country: 'Argentina',
            street: 'Guido 135'
        },
        {
            name: 'PALACIO ALCORTA',
            location: 'Buenos Aires',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=PALACIO+ALCORTA+1',
                'https://via.placeholder.com/800x600/666/fff?text=PALACIO+ALCORTA+2',
                'https://via.placeholder.com/800x600/666/fff?text=PALACIO+ALCORTA+3'
            ],
            category: 'Arquitectura Residencial',
            area: '130 m²',
            year: '2023',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Ciudad de Buenos Aires',
            country: 'Argentina',
            street: 'Guido'
        },
        {
            name: 'VIDT',
            location: 'Buenos Aires',
            images: [
                'https://via.placeholder.com/800x600/666/fff?text=VIDT+1',
                'https://via.placeholder.com/800x600/666/fff?text=VIDT+2',
                'https://via.placeholder.com/800x600/666/fff?text=VIDT+3'
            ],
            category: 'Arquitectura Residencial',
            area: '130 m²',
            year: '2022',
            design: 'Estudio IN SITU/',
            construction: 'Estudio IN SITU/',
            city: 'Ciudad de Buenos Aires',
            country: 'Argentina',
            street: 'Guido'
        }
    ],
    flipping: [
        {
            name: 'PROYECTO FLIPPING 1',
            location: 'Madrid',
            images: [
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+1-1',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+1-2',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+1-3'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.'
        },
        {
            name: 'PROYECTO FLIPPING 2',
            location: 'Barcelona',
            images: [
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+2-1',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+2-2',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+2-3',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+2-4'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore.'
        },
        {
            name: 'PROYECTO FLIPPING 3',
            location: 'Valencia',
            images: [
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+3-1',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+3-2',
                'https://via.placeholder.com/800x600/888/fff?text=FLIPPING+3-3'
            ],
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.'
        }
    ]
};

let currentProjectSection = null;
let currentProjectIndex = 0;
let currentImageIndex = 0;
let modalInactivityTimer = null;
let lastScrollY = window.scrollY;

// ==================== WELCOME ANIMATION ====================
window.addEventListener('DOMContentLoaded', () => {
    const welcome = document.getElementById('welcome-screen');
    const logoAnim = document.getElementById('logo-anim');
    const sloganAnim = document.getElementById('slogan-anim');

    setTimeout(() => {
        logoAnim.classList.add('shifted');
        sloganAnim.classList.add('visible');
    }, 1000);

    setTimeout(() => {
        welcome.style.opacity = 0;
        setTimeout(() => {
            welcome.style.display = 'none';
        }, 1000);
    }, 3200);
    
    renderProjects('social');
    renderProjects('residential');
    renderProjects('flipping');
});

// ==================== MOBILE NAVIGATION ====================
const navToggle = document.getElementById('nav-toggle');
const navList = document.getElementById('nav-list');

navToggle.addEventListener('click', () => {
    navList.classList.toggle('show');
});

document.addEventListener('click', (e) => {
    if (window.innerWidth <= 700) {
        const nav = document.querySelector('nav');
        if (!nav.contains(e.target)) {
            navList.classList.remove('show');
        }
    }
});

// ==================== SECTION NAVIGATION ====================
const navLinks = document.querySelectorAll('nav a[data-section]');
const sections = document.querySelectorAll('.main-section');

navLinks.forEach(link => {
    link.addEventListener('click', (e) => {
        e.preventDefault();
        const section = link.dataset.section;
        
        navLinks.forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        
        sections.forEach(s => s.classList.remove('active'));
        document.getElementById(`section-${section}`).classList.add('active');
        
        navList.classList.remove('show');
    });
});

// ==================== HEADER SCROLL BEHAVIOR ====================
const header = document.querySelector('header');

window.addEventListener('scroll', () => {
    const currentScrollY = window.scrollY;
    
    if (currentScrollY > lastScrollY && currentScrollY > 100) {
        header.classList.add('hidden');
    } else {
        header.classList.remove('hidden');
    }
    
    lastScrollY = currentScrollY;
});

// ==================== PROJECT MODAL ====================
const modal = document.getElementById('project-modal');
const modalClose = document.getElementById('modal-close');
const modalInfo = document.getElementById('modal-info');
const modalTitle = document.getElementById('modal-title');
const modalText = document.getElementById('modal-text');
const modalImage = document.getElementById('modal-image');
const modalCounter = document.getElementById('modal-counter');
const modalPrev = document.getElementById('modal-prev');
const modalNext = document.getElementById('modal-next');
const nextProjectInfo = document.getElementById('next-project-info');
const nextProjectData = document.getElementById('next-project-data');

function openProjectModal(section, projectIndex) {
    currentProjectSection = section;
    currentProjectIndex = projectIndex;
    currentImageIndex = 0;
    
    updateModalContent();
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
    resetModalInactivity();
}

function closeProjectModal() {
    modal.classList.remove('active');
    document.body.style.overflow = '';
    clearTimeout(modalInactivityTimer);
}

function updateModalContent() {
    const project = projectsData[currentProjectSection][currentProjectIndex];
    const totalImages = project.images.length;
    const isLastImage = currentImageIndex === totalImages - 1;
    const hasNextProject = currentProjectIndex < projectsData[currentProjectSection].length - 1;
    const isFirstImage = currentImageIndex === 0;
    
    modalTitle.textContent = project.name;
    
    // Generar el contenido con los datos del proyecto
    if (project.category) {
        modalText.innerHTML = `
            <div class="modal-text-item">
                <span class="modal-text-label">Categoría:</span>
                <span class="modal-text-value">${project.category}</span>
            </div>
            <div class="modal-text-item">
                <span class="modal-text-label">Área:</span>
                <span class="modal-text-value">${project.area}</span>
            </div>
            <div class="modal-text-item">
                <span class="modal-text-label">Año:</span>
                <span class="modal-text-value">${project.year}</span>
            </div>
            <div class="modal-text-item">
                <span class="modal-text-label">Diseño:</span>
                <span class="modal-text-value">${project.design}</span>
            </div>
            <div class="modal-text-item">
                <span class="modal-text-label">Construcción:</span>
                <span class="modal-text-value">${project.construction}</span>
            </div>
            <div class="modal-text-item">
                <span class="modal-text-label">Ciudad:</span>
                <span class="modal-text-value">${project.city}</span>
            </div>
            <div class="modal-text-item">
                <span class="modal-text-label">País:</span>
                <span class="modal-text-value">${project.country}</span>
            </div>
        `;
    } else {
        modalText.textContent = project.description || '';
    }
    
    modalImage.src = project.images[currentImageIndex];
    modalImage.alt = `${project.name} - Imagen ${currentImageIndex + 1}`;
    modalCounter.textContent = `${String(currentImageIndex + 1).padStart(2, '0')} — ${String(totalImages).padStart(2, '0')}`;
    
    if (isFirstImage) {
        modalInfo.classList.remove('hide-description');
    } else {
        modalInfo.classList.add('hide-description');
    }
    
    if (isLastImage && hasNextProject) {
        const nextProject = projectsData[currentProjectSection][currentProjectIndex + 1];
        nextProjectData.innerHTML = `
            <img src="${nextProject.images[0]}" alt="${nextProject.name}" class="next-project-thumbnail">
            <div class="next-project-title">${nextProject.name}</div>
        `;
        nextProjectInfo.dataset.canShow = 'true';
    } else {
        nextProjectInfo.dataset.canShow = 'false';
        nextProjectInfo.classList.remove('visible');
    }
    
    resetModalInactivity();
}

function navigateModalImage(direction) {
    const project = projectsData[currentProjectSection][currentProjectIndex];
    const totalImages = project.images.length;
    const isLastImage = currentImageIndex === totalImages - 1;
    const hasNextProject = currentProjectIndex < projectsData[currentProjectSection].length - 1;
    const hasPrevProject = currentProjectIndex > 0;
    
    if (direction === 'next') {
        if (isLastImage && hasNextProject) {
            currentProjectIndex++;
            currentImageIndex = 0;
        } else if (!isLastImage) {
            currentImageIndex++;
        }
    } else {
        if (currentImageIndex > 0) {
            currentImageIndex--;
        } else if (hasPrevProject) {
            currentProjectIndex--;
            currentImageIndex = projectsData[currentProjectSection][currentProjectIndex].images.length - 1;
        }
    }
    
    updateModalContent();
}

modalClose.addEventListener('click', (e) => {
    e.stopPropagation();
    closeProjectModal();
});

modalPrev.addEventListener('click', (e) => {
    e.stopPropagation();
    navigateModalImage('prev');
});

modalNext.addEventListener('click', (e) => {
    e.stopPropagation();
    navigateModalImage('next');
});

// Show next project info on hover - FIX PRINCIPAL
modalNext.addEventListener('mouseenter', () => {
    if (nextProjectInfo.dataset.canShow === 'true') {
        nextProjectInfo.classList.add('visible');
    }
});

modalNext.addEventListener('mouseleave', () => {
    nextProjectInfo.classList.remove('visible');
});

modal.addEventListener('click', (e) => {
    if (e.target === modal) {
        closeProjectModal();
    }
});

modal.addEventListener('mousemove', () => {
    if (modal.classList.contains('active')) {
        resetModalInactivity();
    }
});

// ==================== MODAL UI AUTO-HIDE ====================
const modalUIElements = [modalPrev, modalNext, modalCounter];

function hideModalUI() {
    modalUIElements.forEach(el => el.classList.add('hide-ui'));
}

function showModalUI() {
    modalUIElements.forEach(el => el.classList.remove('hide-ui'));
}

function resetModalInactivity() {
    showModalUI();
    clearTimeout(modalInactivityTimer);
    modalInactivityTimer = setTimeout(hideModalUI, 3000);
}

// Keyboard navigation
document.addEventListener('keydown', (e) => {
    if (modal.classList.contains('active')) {
        if (e.key === 'Escape') {
            closeProjectModal();
        } else if (e.key === 'ArrowLeft') {
            navigateModalImage('prev');
        } else if (e.key === 'ArrowRight') {
            navigateModalImage('next');
        }
        resetModalInactivity();
    }
});

// ==================== TOUCH SWIPE FOR MOBILE ====================
let touchStartX = 0;
let touchEndX = 0;

function handleSwipe() {
    if (touchEndX < touchStartX - 50) {
        navigateModalImage('next');
    }
    if (touchEndX > touchStartX + 50) {
        navigateModalImage('prev');
    }
}

modal.addEventListener('touchstart', (e) => {
    if (modal.classList.contains('active')) {
        touchStartX = e.changedTouches[0].screenX;
    }
}, false);

modal.addEventListener('touchend', (e) => {
    if (modal.classList.contains('active')) {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
    }
}, false);

// ==================== RENDER PROJECTS GRID ====================
function renderProjects(section) {
    const container = document.getElementById(`${section}-projects`);
    if (!container || !projectsData[section]) {
        return;
    }
    
    container.innerHTML = '';
    
    projectsData[section].forEach((project, index) => {
        const card = document.createElement('div');
        card.className = 'project-card';
        card.innerHTML = `
            <img src="${project.images[0]}" alt="${project.name}" class="project-image">
            <div class="project-info">
                <div class="project-name">${project.name}</div>
                <div class="project-location">${project.location}</div>
            </div>
        `;
        card.addEventListener('click', () => {
            openProjectModal(section, index);
        });
        container.appendChild(card);
    });
}

// ==================== GOOGLE MAPS ====================
function initMap() {
    // Centro del mapa en Madrid (Puerta del Sol)
    const mapCenter = { lat: 40.4168, lng: -3.7038 };
    
    const map = new google.maps.Map(document.getElementById('map'), {
        zoom: 12,
        center: mapCenter,
        mapTypeControl: true,
        streetViewControl: true,
        fullscreenControl: true
    });
    
    // Crear un pin de ejemplo en Madrid
    const marker = new google.maps.Marker({
        position: mapCenter,
        map: map,
        title: 'IN SITU/ - Madrid'
    });
    
    // Info Window con información básica
    const infoWindow = new google.maps.InfoWindow({
        content: `
            <div style="padding: 10px;">
                <h3 style="margin: 0 0 8px 0; font-family: 'Oswald', sans-serif; font-size: 1.2rem;">IN SITU/</h3>
                <p style="margin: 0; font-size: 0.9rem; color: #666;">Madrid, España</p>
            </div>
        `
    });
    
    // Mostrar info window al hacer click en el marker
    marker.addListener('click', () => {
        infoWindow.open(map, marker);
    });
}